@using DicomApp.CommonDefinitions.DTO.ShipmentDTOs
@using DicomApp.CommonDefinitions.DTO;
@model List<ShipDTO>
@{
    Layout = "/Views/Shared/_PrintLayout.cshtml";
    int Index = 0;
}
<link href="~/dist/css/policystyle.css" rel="stylesheet" />

<main>
    <div class="Shipment-Information-Section">
        <div class="Description-Section">
            <table class="table text-center">
                <thead>
                    <tr>
                        <td class="text-nowrap">Code</td>
                        <td class="text-wrap">Created At</td>
                        <td class="text-nowrap">Customer</td>
                        <td class="text-nowrap">Service</td>
                        <td class="text-nowrap">RED Fees</td>
                        <td class="text-wrap">Vendor Cash</td>
                        <td class="text-nowrap">Total</td>
                        <td class="text-nowrap">Status</td>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var groupedSHIPS in Model.GroupBy(t => t.StatusId))
                    {
                        <tr>
                            <td class="td-small text-nowrap text-center mt-2" colspan="8">
                                <partial name="~/Views/Shared/Shipment/_StatusSwitch22.cshtml" model="@groupedSHIPS.FirstOrDefault().StatusDTO"></partial>
                                &nbsp;
                                <span style="margin-bottom: 0px; background-color: #8f8f8f4d; color: #000000; font-weight: bolder !important;" class="Filter-Table font-weight-bold">@groupedSHIPS.Count() Order</span>
                            </td>
                        </tr>
                        foreach (var ship in groupedSHIPS)
                        {
                            <tr>
                                <td class="text-nowrap td-small" onclick="ShipmentDetails('Shipment', @ship.ShipmentId)" data-toggle="modal" data-target="#ShipmentDetails"><b style="font-size: 14px;">@ship.RefId</b></td>
                                <td class="text-nowrap td-small"><b>@ship.CreatedAt.ToString("d/M/yyyy") <br /> @ship.CreatedAt.ToString("hh:mm tt")</b></td>
                                <td class="td-small">
                                    @ship.CustomerDetailsDTO.CustomerName
                                    <br />
                                    <label class="text-nowrap mt-1"><i class="fa fa-map-marker"></i>&nbsp;@ship.AreaName</label>
                                </td>
                                <td class="td-small text-nowrap font-weight-bold">@ship.ShipmentServiceName</td>

                                @if (ship.StatusId == (int)EnumStatus.Delivered || ship.StatusId == (int)EnumStatus.Paid_To_Vendor || ship.StatusId == (int)EnumStatus.Returned)
                                {
                                    var RedTrans = ship.TransactionDTOs.FirstOrDefault(t => t.ReceiverId == (int)EnumAccountId.RED_Main_Account);
                                    var VendorTrans = ship.TransactionDTOs.FirstOrDefault(t => t.ReceiverId == t.VendorId);

                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@RedTrans.Total</b></td>
                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@VendorTrans.Total</b></td>
                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@(RedTrans.Total + VendorTrans.Total)</b></td>
                                }
                                else if (ship.StatusId == (int)EnumStatus.Refunded)
                                {
                                    var RedTrans = ship.TransactionDTOs.FirstOrDefault(t => t.ReceiverId == (int)EnumAccountId.RED_Main_Account);
                                    var VendorTrans = ship.TransactionDTOs.FirstOrDefault(t => t.ReceiverId == t.VendorId);

                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@RedTrans.Total</b></td>
                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">0</b></td>
                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@VendorTrans.Total</b></td>
                                }
                                else if (ship.StatusId == (int)EnumStatus.Cancelled)
                                {
                                    if (ship.TransactionDTOs != null && ship.TransactionDTOs.Count() > 0)
                                    {
                                        var RedTrans = ship.TransactionDTOs.FirstOrDefault(t => t.ReceiverId == (int)EnumAccountId.RED_Main_Account);

                                        <td class="text-nowrap td-small"><b style="font-size: 16px;">@RedTrans.Total</b></td>
                                        <td class="text-nowrap td-small"><b style="font-size: 16px;">0</b></td>
                                        <td class="text-nowrap td-small"><b style="font-size: 16px;">@RedTrans.Total</b></td>
                                    }
                                    else
                                    {
                                        <td class="text-nowrap td-small"><b style="font-size: 16px;">0</b></td>
                                        <td class="text-nowrap td-small"><b style="font-size: 16px;">0</b></td>
                                        <td class="text-nowrap td-small"><b style="font-size: 16px;">0</b></td>
                                    }
                                }
                                else
                                {
                                    double TotalREDFees = ship.FeesDetailsDTO.ShippingFees + ship.FeesDetailsDTO.GameFees + ship.FeesDetailsDTO.WeightFees + ship.FeesDetailsDTO.SizeFees + ship.FeesDetailsDTO.PartialDeliveryFees;

                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@TotalREDFees</b></td>
                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@ship.FeesDetailsDTO.VendorCash</b></td>
                                    <td class="text-nowrap td-small"><b style="font-size: 16px;">@ship.FeesDetailsDTO.Total</b></td>
                                }

                                <partial name="~/Views/Shared/Shipment/_StatusSwitch.cshtml" model="@ship.StatusDTO"></partial>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</main>